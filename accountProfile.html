<!DOCTYPE html>

<html>

<head>
	<title>vChat - Login Page</title>
	<meta name="description" content="SAT Project">
	<meta property="og:title" content="vChat - Official Website">
	<meta property="og:site_name" content="vChat">
	<meta property="og:description" content="SAT Project">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8">
	<link rel="stylesheet" href="css/stylesheet.css">
	<script src="https://unpkg.com/localbase/dist/localbase.dev.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.js"></script>
	<link rel="icon" type="image/png" href="./assets/images/favicon.jpg">

</head>

<body>
	

	<div class="logo2">
		<a href="./index.html">
			<img src="./assets/images/vchatLogo.png" style="position:absolute; top: 5%; left: 3%;" width="10.3%"
				alt="vChatLogo">
		</a>
	</div>


	<form id="accProfileForm" class="accountProfileContainer" action="./profilePage.html" method="GET">

		<label class="profileAccountHeader">
			<img 	style="position: relative; top: -35px;" 
					class="userIcon2"
					id="profileAccountHeader"
					src="./assets/images/testIcon.jpg" 
					width="200"
					height="200" 
					alt="profilePicture"
					>
		</label>

		<div class="loginBarFonts" style="top: 13%;">
			<i><abbr
					title="Paste the direct link to the image, you can upload your image to discord and 'Copy Link' for free and easy hosting!">change
					profile picture?</abbr></i>
		</div>

		<input 	class="loginBar" 
				required
				id="pfp" 
				type="url" 
				style="margin-top: 16%;"
				placeholder="paste direct url of the image"
				value="user profile picture link goes here"
				>
		

		<div class="loginBarFonts" style="top: 2%;">
			<i>email address</i>
		</div>

		<input 	class="loginBar"
				required
				id="email" 
				type="email" 
				style="margin-top: 2%;"
				value="user email goes here"
				>


		<div class="loginBarFonts" style="margin-top: 2%;">
			<i><abbr
				title="You  are not able to change your username. If you wish to go under a new allias, create a new account.">username</abbr><i>
		</div>

		<input 	class="loginBar" 
				id="uid" 
				type="text"
				required
				readonly
				value="username goes here"
				>

		<div class="loginBarFonts" style="margin-top: 2%;">
			<i>password<i>
		</div>

		<input class="loginBar" 
				id="pwd" 
				type="password" 
				auto-complete="on" 
				required
				minlength="6" 
				pattern="[A-Za-z0-9_]{6,16}"
				value="user password goes here"
				title="Your username must be between 6-16 characters, numbers and only underscores are accepted.">

		<script>
			const db = new Localbase("vChatDataBase");
			const pageCookie = Cookies.get('cookieUsername')
			const updateButton = document.getElementById("accProfileForm");
			
			
			db.collection('users').doc({ username: pageCookie }).get().then(doc => {
				document.getElementById("profileAccountHeader").src = doc[`icon`]
				document.getElementById("pfp").value = doc[`icon`];
				document.getElementById("email").value = doc[`email`];
				document.getElementById("uid").value = doc[`username`];
				document.getElementById("pwd").value = doc[`password`];
			})

			updateButton.addEventListener('submit', function (e) {
				e.preventDefault();

				const icon = document.getElementById("pfp");
				const email = document.getElementById("email");
				const username = document.getElementById("uid");
				const password = document.getElementById("pwd");


				db.collection('users').doc({ username: username.value }).set({
				  email: email.value, 
				  username: username.value,
				  password: password.value,
				  icon: icon.value
				})

				alert("Your details have been updated!")
				return window.location.href = './profilePage.html'
			})
		</script>

		<button type="submit" id="saveButton" class="saveButton" style="margin-bottom: 25%;">save!</button>
	</form>
</body>

</html>